var eo_include_dates,eo_exclude_dates,eo_viewing_month;
(function(d){function n(a,b,c){var h=new Array("SU","MO","TU","WE","TH","FR","SA"),g=[];switch(a.schedule){case "once":case "custom":var i=d.datepicker.formatDate("yy-mm-dd",a.start);g.push(i);return g;case "daily":if(a.start<b){var e=Math.abs((b-a.start)/864E5)-1;e%=a.frequency}else e=parseInt(a.start.getDate());var l=a.frequency,j=[],k=new Date(b);k.setDate(b.getDate()+(e-1));j.push(k);break;case "weekly":var f=b.getDay();j=[];d.each(a.schedule_meta,function(o,p){o=h.indexOf(p);k=new Date(a.start);
k.setDate(a.start.getDate()+(o-a.start.getDay()+7)%7);if(k<b){e=Math.abs((b-a.start)/864E5);e-=e%(a.frequency*7);k.setDate(k.getDate()+e)}j.push(k)});l=7*a.frequency;break;case "monthly":if(((b.getFullYear()-a.start.getFullYear())*12+(b.getMonth()-a.start.getMonth()))%a.frequency!=0)return;if(a.schedule_meta.match(/BYMONTHDAY=(\d+)/)){var m=a.start.getDate();c=c.getDate();if(m<=c)f=new Date(b.getFullYear(),b.getMonth(),m)}else{f=a.schedule_meta.match(/BYDAY=(\d+)(MO|TU|WE|TH|FR|SA|SU)/);i=parseInt(f[1])-
1;m=a.start.getDay();if(i>=5){f=c.getDay();c=c.getDate()+(m-f-7)%7}else{f=b.getDay();c=(m-f+7)%7+(i-1)*7+1}f=new Date(b);f.setDate(c)}if(f<=a.schedule_last){i=d.datepicker.formatDate("yy-mm-dd",f);g.push(i)}return g;case "yearly":if((b.getFullYear()-a.start.getFullYear())%a.frequency!=0)return g;c=new Date(b.getFullYear(),a.start.getMonth(),a.start.getDate());if(b.getMonth()==a.start.getMonth()&&c.getMonth()==a.start.getMonth()){f=new Date(a.start);f.setYear(b.getFullYear());if(f<=a.schedule_last){i=
d.datepicker.formatDate("yy-mm-dd",f);g.push(i)}}return g;default:return g}for(m in j)for(f=new Date(j[m]);f<=c&&f<=a.schedule_last;){i=d.datepicker.formatDate("yy-mm-dd",f);g.push(i);f.setDate(f.getDate()+l)}return g}if(!Array.prototype.indexOf)Array.prototype.indexOf=function(a,b){var c=this.length;b=Number(b)||0;b=b<0?Math.ceil(b):Math.floor(b);if(b<0)b+=c;for(;b<c;b++)if(b in this&&this[b]===a)return b;return-1};Date.prototype.eoGetOrdinal=function(){switch(this.getDate()){case 1:case 21:case 31:return"st";
case 2:case 22:return"nd";case 3:case 23:return"rd";default:return"th"}};window.eventOrganiserSchedulePicker={init:function(a){var b=this;this.options=a;this.schedule=a.schedule;this.set_up_datepickers();this.set_up_timepickers();d(".event-date :input").not(".eo-time-picker").change(function(){b.update_schedule();b.update_form();d(this).hasClass("eo-all-day-toggle")||b.update_occurrencepicker_rules()});this.update_schedule();this.update_form();a=new Date;eo_viewing_month=[a.getFullYear(),a.getMonth()+
1];this.schedule.generate_dates_by_rule(a.getFullYear(),a.getMonth()+1,{})},set_up_datepickers:function(){var a=this,b=this.options.views,c=this.options.locale;d(b.start_date).data("eo-datepicker","start");d(b.end_date).data("eo-datepicker","end");d(b.is_all_day).addClass("eo-all-day-toggle");if(d(b.schedule_last_date))var h=d(b.schedule_last_date).datepicker({dateFormat:this.options.format,changeMonth:true,changeYear:true,monthNamesShort:c.monthAbbrev,dayNamesMin:c.dayAbbrev,firstDay:parseInt(this.options.startday)}).data("eo-datepicker",
"schedule_last");var g=d(b.start_date+", "+b.end_date).datepicker({dateFormat:this.options.format,changeMonth:true,changeYear:true,monthNamesShort:c.monthAbbrev,dayNamesMin:c.dayAbbrev,firstDay:parseInt(this.options.startday),onSelect:function(e){var l="start"==d(this).data("eo-datepicker")?"minDate":"maxDate",j=d(this).data("datepicker");e=d.datepicker.parseDate(j.settings.dateFormat||d.datepicker._defaults.dateFormat,e,j.settings);g.not(this).datepicker("option",l,e);this.id=="from_date"&&h.datepicker("option",
"minDate",e);a.update_occurrencepicker_rules();a.update_form()}}),i=d(b.occurrence_picker);if(i.length>0){i.datepicker({dateFormat:"yy-mm-dd",changeMonth:true,changeYear:true,monthNamesShort:c.monthAbbrev,dayNamesMin:c.dayAbbrev,firstDay:parseInt(this.options.startday),onSelect:function(e){eventOrganiserSchedule.add_or_remove_date(e);d(eventOrganiserSchedulePicker.options.views.include).val(eventOrganiserSchedule.exclude.join(",\r\n"));d(eventOrganiserSchedulePicker.options.views.exclude).val(eventOrganiserSchedule.exclude.join(",\r\n"))},
beforeShowDay:function(e){e=d.datepicker.formatDate("yy-mm-dd",e);if(eventOrganiserSchedule.is_date_eventful(e)[0])return[true,"ui-state-active",""];return[true,"ui-state-disabled",""]},onChangeMonthYear:eventOrganiserSchedule.generate_dates_by_rule}).hide().find(".ui-datepicker-inline").click(function(e){if(!e)e=window.event;e.cancelBubble=true;e.stopPropagation&&e.stopPropagation()});d("html").click(function(){i.hide()})}d(b.occurrence_picker_toggle).click(function(e){e.preventDefault();e.stopPropagation();
i.toggle();if(i.is(":visible")){d(this).val(c.hideDates);d(b.occurrence_picker).datepicker("refresh")}else d(this).val(c.showDates)})},update_occurrencepicker_rules:function(){eo_exclude_dates=[];eo_include_dates=[];this.schedule.generate_dates_by_rule(eo_viewing_month[0],eo_viewing_month[1],{});d(this.options.views.occurrence_picker).datepicker("refresh")},set_up_timepickers:function(){var a=this.options,b=this.options.views;d(b.start_time+", "+b.end_time).timepicker({showPeriodLabels:!a.is24hour,
showPeriod:!this.options.is24hour,showLeadingZero:a.is24hour,periodSeparator:"",amPmText:a.locale.meridian,hourText:a.locale.hour,minuteText:a.locale.minute}).addClass("eo-time-picker")},update_schedule:function(){var a=new Array("SU","MO","TU","WE","TH","FR","SA"),b=this.options.views,c={schedule:d(b.schedule).val(),frequency:parseInt(d(b.frequency).val()),schedule_last:d(b.schedule_last_date).datepicker("getDate"),start:d(b.start_date).datepicker("getDate"),end:d(b.end_date).datepicker("getDate"),
is_all_day:d(b.is_all_day).attr("checked"),include:d(b.include).length>0?d(b.include).val().split(","):[],exclude:d(b.exclude).length>0?d(b.exclude).val().split(","):[]};if(c.schedule=="weekly"){c.schedule_meta=[];if(d(b.week_repeat+" :checkbox:checked").length==0){var h=c.start.getDay();d(b.week_repeat+" :checkbox[value='"+a[h]+"']").attr("checked",true)}d(b.week_repeat+" :checkbox:checked").each(function(){c.schedule_meta.push(d(this).val())})}else if(c.schedule=="monthly")if(d(b.month_repeat+" :radio:checked").val()==
"BYMONTHDAY=")c.schedule_meta="BYMONTHDAY="+c.start.getDate();else{b=c.start.getDay()%7;h=parseInt(Math.floor((c.start.getDate()-1)/7));c.schedule_meta="BYDAY="+(h+1)+a[b]}this.schedule=eventOrganiserSchedule.init(c);eo_exclude_dates=c.exclude;eo_include_dates=c.include},update_form:function(){var a=this.options.views,b=this.options.locale,c=this.schedule;d(".event-date :input").attr("disabled",!this.options.editable).toggleClass("ui-state-disabled",!this.options.editable);this.options.editable&&
d(a.start_time+", "+a.end_time).attr("disabled",c.is_all_day).toggleClass("ui-state-disabled",c.is_all_day);if(c.schedule=="once"||c.schedule=="custom"){d(a.recurrence_section+" :input").attr("disabled",true);d(a.recurrence_section).hide()}else{d(a.recurrence_section+" :input").attr("disabled",false);d(a.recurrence_section).fadeIn(700)}switch(c.schedule){case "once":case "custom":d(c.frequency).val("1");d(a.month_repeat+", "+a.week_repeat).show();break;case "weekly":c.frequency>1?d(a.schedule_span).text(b.weeks):
d(a.schedule_span).text(b.week);d(a.week_repeat).fadeIn(700);d(a.week_repeat+" :input").attr("disabled",false);d(a.month_repeat).hide();d(a.month_repeat+" :input").attr("disabled",true);break;case "monthly":c.frequency>1?d(a.schedule_span).text(b.months):d(a.schedule_span).text(b.month);d(a.month_repeat).fadeIn(700);d(a.month_repeat+" :input").attr("disabled",false);d(a.week_repeat).hide();d(a.week_repeat+" :input").attr("disabled",true);break;case "daily":c.frequency>1?d(a.schedule_span).text(b.days):
d(a.schedule_span).text(b.day);d(a.week_repeat+", "+a.month_repeat).hide();d(a.week_repeat+" :input, "+a.month_repeat+" :input").attr("disabled",true);break;case "yearly":c.frequency>1?d(a.schedule_span).text(b.years):d(a.schedule_span).text(b.year);d(a.week_repeat+", "+a.month_repeat).hide();d(a.week_repeat+" :input, "+a.month_repeat+" :input").attr("disabled",true);break}d("#venue_select").val()===null&&d("tr.venue_row").hide();d(a.summary).html(c.generate_summary(b))}};eventOrganiserSchedule={self:this,
init:function(a){a=d.extend({},{schedule:"once",frequency:1,schedule_last:new Date,start:new Date,end:new Date,is_all_day:false,dates_by_rule:[]},a);for(var b in a)this[b]=a[b];return this},generate_dates_by_rule:function(a,b){eo_viewing_month=[a,b];var c=new Date(a,b-1,1);a=new Date(new Date(a,b,1)-1);if(!(this.schedule_last<c||this.start>a))this.dates_by_rule=n(this,c,a)},generate_summary:function(a){var b=a.weekDay,c=a.summary+" ",h={monthNamesShort:a.monthAbbrev,dayNamesMin:a.dayAbbrev,monthNames:a.monthNames},
g=this.schedule,i=new Array("SU","MO","TU","WE","TH","FR","SA");switch(g){case "once":return"This event will be a one-time event";case "custom":case "daily":c+=this.frequency>1?sprintf(a.dayPlural,this.frequency):a.daySingle;break;case "weekly":c+=this.frequency>1?sprintf(a.weekPlural,this.frequency):a.weekSingle;g=d.map(this.schedule_meta,function(l){return b[i.indexOf(l)]});c+=" "+g.join(", ");break;case "monthly":c+=this.frequency>1?sprintf(a.monthPlural,this.frequency):a.monthSingle;if(this.schedule_meta.match(/BYMONTHDAY=(\d+)/))c=
c+" "+g.start.getDate()+this.start.eoGetOrdinal();else{g=this.schedule_meta.match(/BYDAY=(\d+)(MO|TU|WE|TH|FR|SA|SU)/);var e=parseInt(g[1])-1;c=c+" "+a.occurrence[e]+" "+b[i.indexOf(g[2])]}break;case "yearly":c+=this.frequency>1?sprintf(a.yearPlural,this.frequency):a.yearSingle;c=c+" "+d.datepicker.formatDate("MM d",this.start,h)+this.start.eoGetOrdinal();break}if(this.schedule_last!=null)c=c+" "+a.until+" "+d.datepicker.formatDate("MM d'"+this.schedule_last.eoGetOrdinal()+"' yy",this.schedule_last,
h);return c},is_date_eventful:function(a){if(d.inArray(a,eventOrganiserSchedule.dates_by_rule)>-1){a=d.inArray(a,eventOrganiserSchedule.exclude);return a>-1?[false,a]:[true,-1]}else{a=d.inArray(a,eventOrganiserSchedule.include);return a>-1?[true,a]:[false,-1]}},add_or_remove_date:function(a){var b=eventOrganiserSchedule.is_date_eventful(a);if(b[0]){b=b[1];if(b>-1)eventOrganiserSchedule.include.splice(b,1);else d.inArray(a,eventOrganiserSchedule.exclude)<0&&eventOrganiserSchedule.exclude.push(a)}else{b=
b[1];if(b>-1)eventOrganiserSchedule.exclude.splice(b,1);else d.inArray(a,eventOrganiserSchedule.include)<0&&eventOrganiserSchedule.include.push(a)}eo_exclude_dates=eventOrganiserSchedule.exclude;eo_include_dates=eventOrganiserSchedule.include}}})(jQuery);
(function(d){function n(c){return Object.prototype.toString.call(c).slice(8,-1).toLowerCase()}function a(c,h){for(var g=[];h>0;g[--h]=c);return g.join("")}var b=function(){b.cache.hasOwnProperty(arguments[0])||(b.cache[arguments[0]]=b.parse(arguments[0]));return b.format.call(null,b.cache[arguments[0]],arguments)};b.format=function(c,h){var g=1,i=c.length,e="",l=[],j,k,f,m;for(j=0;j<i;j++){e=n(c[j]);if(e==="string")l.push(c[j]);else if(e==="array"){f=c[j];if(f[2]){e=h[g];for(k=0;k<f[2].length;k++){if(!e.hasOwnProperty(f[2][k]))throw b('[sprintf] property "%s" does not exist',
f[2][k]);e=e[f[2][k]]}}else e=f[1]?h[f[1]]:h[g++];if(/[^s]/.test(f[8])&&n(e)!="number")throw b("[sprintf] expecting number but found %s",n(e));switch(f[8]){case "b":e=e.toString(2);break;case "c":e=String.fromCharCode(e);break;case "d":e=parseInt(e,10);break;case "e":e=f[7]?e.toExponential(f[7]):e.toExponential();break;case "f":e=f[7]?parseFloat(e).toFixed(f[7]):parseFloat(e);break;case "o":e=e.toString(8);break;case "s":e=(e=String(e))&&f[7]?e.substring(0,f[7]):e;break;case "u":e>>>=0;break;case "x":e=
e.toString(16);break;case "X":e=e.toString(16).toUpperCase();break}e=/[def]/.test(f[8])&&f[3]&&e>=0?"+"+e:e;k=f[4]?f[4]=="0"?"0":f[4].charAt(1):" ";m=f[6]-String(e).length;k=f[6]?a(k,m):"";l.push(f[5]?e+k:k+e)}}return l.join("")};b.cache={};b.parse=function(c){c=c;for(var h=[],g=[],i=0;c;){if((h=/^[^\x25]+/.exec(c))!==null)g.push(h[0]);else if((h=/^\x25{2}/.exec(c))!==null)g.push("%");else if((h=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(c))!==null){if(h[2]){i|=
1;var e=[],l=h[2],j=[];if((j=/^([a-z_][a-z_\d]*)/i.exec(l))!==null)for(e.push(j[1]);(l=l.substring(j[0].length))!=="";)if((j=/^\.([a-z_][a-z_\d]*)/i.exec(l))!==null)e.push(j[1]);else if((j=/^\[(\d+)\]/.exec(l))!==null)e.push(j[1]);else throw"[sprintf] huh?";else throw"[sprintf] huh?";h[2]=e}else i|=2;if(i===3)throw"[sprintf] mixing positional and named placeholders is not (yet) supported";g.push(h)}else throw"[sprintf] huh?";c=c.substring(h[0].length)}return g};d.sprintf=b;d.vsprintf=function(c,h,
g){g=h.slice(0);g.splice(0,0,c);return b.apply(null,g)}})(typeof exports!="undefined"?exports:window);

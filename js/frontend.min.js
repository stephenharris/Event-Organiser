var eventorganiser=eventorganiser||{};
(function(a){jQuery(document).ready(function(){function f(b){var d=b.categories,g="<select class='eo-cal-filter' id='eo-event-cat'>";g+="<option value=''>"+b.buttonText.cat+"</option>";for(b=0;b<d.length;b++)g+="<option class='cat-colour-"+d[b].colour+" cat' value='"+d[b].slug+"'>"+d[b].name+"</option>";g+="</select>";d=a("<span class='fc-header-dropdown filter-category'></span>");d.append(g);return d}function j(){return a("<span class='fc-header-goto'><input type='hidden' class='eo-mini-calendar'/></span>")}function l(b){var d=
b.venues,g="<select class='eo-cal-filter' id='eo-event-venue'>";g+="<option value=''>"+b.buttonText.venue+"</option>";for(b=0;b<d.length;b++)g+="<option value='"+d[b].term_id+"'>"+d[b].name+"</option>";g+="</select>";d=a("<span class='fc-header-dropdown filter-venue'></span>");d.append(g);return d}if(a("#eo-upcoming-dates").length>0&&a("#eo-upcoming-dates").find("li:gt(4)").length>0){var e={more:EOAjaxFront.locale.ShowMore,less:EOAjaxFront.locale.ShowLess};a("#eo-upcoming-dates").find("li:gt(4)").hide().end().after(a('<a href="#" id="eo-upcoming-dates-less">'+
e.less+'</a> <span id="eo-upcoming-dates-pipe">|</span> <a href="#" id="eo-upcoming-dates-more">'+e.more+"</a>"));a("#eo-upcoming-dates-pipe").hide();a("#eo-upcoming-dates-less").hide().click(function(b){b.preventDefault();b=Math.floor((a("#eo-upcoming-dates li:visible").length-1)/5)*5-1;a("#eo-upcoming-dates li:gt("+b+")").hide();a("#eo-upcoming-dates-more,#eo-upcoming-dates-pipe").show();a("#eo-upcoming-dates li:visible").length<=5&&a("#eo-upcoming-dates-less,#eo-upcoming-dates-pipe").hide()});
a("#eo-upcoming-dates-more").click(function(b){b.preventDefault();a("#eo-upcoming-dates-less,#eo-upcoming-dates-pipe, #eo-upcoming-dates li:hidden:lt(5)").show();b=a("#eo-upcoming-dates-pipe").offset();a("html, body").animate({scrollTop:Math.max(b.top+40-a(window).height(),a(window).scrollTop())});a("#eo-upcoming-dates li:hidden").length==0&&a("#eo-upcoming-dates-more,#eo-upcoming-dates-pipe").hide()})}if(a(".eo-fullcalendar").length>0){e=eventorganiser.calendars;for(var m,c=0;c<e.length;c++){var k=
"#eo_fullcalendar_"+(c+1);if(typeof e[c].category==="undefined")e[c].category="";if(typeof e[c].venue==="undefined")e[c].venue="";var o={id:k,year:e[c].year?e[c].year:undefined,month:e[c].month?e[c].month:undefined,date:e[c].date?e[c].date:undefined,category:e[c].event_category,venue:e[c].event_venue,customButtons:{category:f,venue:l,"goto":j},theme:true,categories:eventorganiser.fullcal.categories,venues:eventorganiser.fullcal.venues,timeFormatphp:e[c].timeformatphp,timeFormat:e[c].timeformat,editable:false,
tooltip:e[c].tooltip,firstDay:parseInt(eventorganiser.fullcal.firstDay),weekends:e[c].weekends,allDaySlot:e[c].alldayslot,allDayText:e[c].alldaytext,axisFormat:e[c].axisformat,minTime:e[c].mintime,maxTime:e[c].maxtime,columnFormat:{month:e[c].columnformatmonth,week:e[c].columnformatweek,day:e[c].columnformatday},titleFormat:{month:e[c].titleformatmonth,week:e[c].titleformatweek,day:e[c].titleformatday},header:{left:e[c].headerleft,center:e[c].headercenter,right:e[c].headerright},eventRender:function(b,
d,g){var h=a(g.calendar.options.id).find(".filter-category .eo-cal-filter").val(),i=a(g.calendar.options.id).find(".filter-venue .eo-cal-filter").val();if(typeof h!=="undefined"&&h!=""&&a.inArray(h,b.category)<0)return"<div></div>";if(typeof i!=="undefined"&&i!=""&&i!=b.venue)return"<div></div>";if(!wp.hooks.applyFilters("eventorganiser.fullcalendar_render_event",true,b,d,g))return"<div></div>";g.calendar.options.tooltip&&a(d).qtip({content:{text:b.description,button:"x",title:b.title},position:{my:"top center",
at:"bottom center",viewport:a(window),adjust:{method:"shift none"}},hide:{fixed:true,delay:500,effect:function(){a(this).fadeOut("50")}},border:{radius:4,width:3},style:{classes:"ui-tooltip-shadow",widget:true,tip:"topMiddle"}})},buttonText:{today:EOAjaxFront.locale.today,month:EOAjaxFront.locale.month,week:EOAjaxFront.locale.week,day:EOAjaxFront.locale.day,cat:EOAjaxFront.locale.cat,venue:EOAjaxFront.locale.venue},monthNames:EOAjaxFront.locale.monthNames,monthNamesShort:EOAjaxFront.locale.monthAbbrev,
dayNames:EOAjaxFront.locale.dayNames,dayNamesShort:EOAjaxFront.locale.dayAbbrev,eventColor:"#21759B",defaultView:e[c].defaultview,lazyFetching:"true",events:function(b,d,g,h){var i={start:jQuery.fullCalendar.formatDate(b,"yyyy-MM-dd"),end:jQuery.fullCalendar.formatDate(d,"yyyy-MM-dd"),timeformat:h.timeFormatphp,users_events:h.users_events};if(typeof h.category!=="undefined"&&h.category!="")i.category=h.category;if(typeof h.venue!=="undefined"&&h.venue!="")i.venue=h.venue;i=wp.hooks.applyFilters("eventorganiser.fullcalendar_request",
i,b,d,g,h);a.ajax({url:eventorganiser.ajaxurl+"?action=eventorganiser-fullcal",dataType:"JSON",data:i,success:g})},selectable:false,weekMode:"variable",aspectRatio:1.5,loading:function(b){var d=a("#"+a(this).attr("id")+"_loading");if(b){window.clearTimeout(m);m=window.setTimeout(function(){d.show()},1E3)}else{window.clearTimeout(m);d.hide()}}};o=wp.hooks.applyFilters("eventorganiser.fullcalendar_options",o,e[c]);a(k).fullCalendar(o)}a(".eo-cal-filter").change(function(){a(".eo-fullcalendar").fullCalendar("rerenderEvents")});
a(".eo-mini-calendar").datepicker({dateFormat:"DD, d MM, yy",changeMonth:true,changeYear:true,dateFormat:"DD, d MM, yy",firstDay:parseInt(eventorganiser.fullcal.firstDay),buttonText:EOAjaxFront.locale.gotodate,monthNamesShort:EOAjaxFront.locale.monthAbbrev,dayNamesMin:EOAjaxFront.locale.dayAbbrev,showOn:"button",onSelect:function(b){var d=a(this).parents("div.eo-fullcalendar").attr("id");a("#"+d).fullCalendar("gotoDate",new Date(Date.parse(b)))}})}if(a(".eo_widget_calendar").length>0){a(".eo_widget_calendar tfoot").unbind("click");
a(".eo_widget_calendar").off("click").on("click","tfoot a",function(b){b.preventDefault();var d=a(this).closest(".eo_widget_calendar").attr("id");b={showpastevents:1,"show-long":0,"link-to-single":0};if(typeof EOAjax!=="undefined"&&typeof eventorganiser.widget_calendars!=="undefined")b=eventorganiser.widget_calendars[d];if(typeof eo_widget_cal!=="undefined")b=eo_widget_cal[d];b.eo_month=eveorg_getParameterByName("eo_month",a(this).attr("href"));a.getJSON(EOAjaxFront.adminajax+"?action=eo_widget_cal",
b,function(g){a("#"+d+"_content").html(g)})})}if(a(".eo-agenda-widget").length>0){function p(b,d){a.ajax({url:EOAjaxFront.adminajax,dataType:"JSON",data:{action:"eo_widget_agenda",instance_number:d.number,direction:b,start:d.StartDate,end:d.EndDate},success:function(g){if(!jQuery.isArray(g)||!g[0])return false;else{d.StartDate=g[0].StartDate;d.EndDate=g[g.length-1].StartDate;s(g,d)}}})}function s(b,d){var g=a("#"+d.id+"_container"),h=g.find("ul.dates"),i=h.find("li");a(i).remove();i="";for(c=0;c<
b.length;c++){if(i==""||i!=b[c].StartDate&&d.mode=="day"){i=b[c].StartDate;var q=a('<li class="date" >'+b[c].display+'<ul class="a-date"></ul></li>');h.append(q)}var r=d.add_to_google?a('<li class="event"></li>').append('<span class="cat"></span><span><strong>'+b[c].time+": </strong></span>"+b[c].post_title).append('<div class="meta" style="display:none;"><span>'+b[c].link+"</span><span> \u00a0 </span><span>"+b[c].Glink+"</span></div>"):a('<li class="event"></li>').append("<a class='eo-agenda-event-permalink' href='"+
b[c].event_url+"'><span class='cat'></span><span><strong>"+b[c].time+": </strong></span>"+b[c].post_title+"</a>");r.find("span.cat").css({background:b[c].color});q.append(r)}i=h.find("li");g.find("ul li.event").on("click",function(){a(this).find(".meta").toggle("400")})}for(var n in eo_widget_agenda){n=eo_widget_agenda[n];n.StartDate=a.fullCalendar.formatDate(new Date,"yyyy-MM-dd");n.EndDate=n.StartDate;p(1,n)}a(".eo-agenda-widget .agenda-nav span.button").click(function(b){var d=a(this).parents(".eo-agenda-widget").attr("id");
n=eo_widget_agenda[d];b.preventDefault();b=a(this).hasClass("next")?"+1":a(this).hasClass("prev")?"-1":a(this).parent().hasClass("prev")?"-1":"+1";p(b,n)})}})})(jQuery);function eveorg_getParameterByName(a,f){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");a=(new RegExp("[\\?&]"+a+"=([^&#]*)")).exec(f);return a==null?"":decodeURIComponent(a[1].replace(/\+/g," "))}
function eo_load_map(){for(var a=eventorganiser.map,f=0;f<a.length;f++)if(null!==document.getElementById("eo_venue_map-"+(f+1))){eventorganiser.map[f].markers={};var j=a[f].locations,l={zoom:a[f].zoom,scrollwheel:a[f].scrollwheel,zoomControl:a[f].zoomcontrol,rotateControl:a[f].rotatecontrol,panControl:a[f].pancontrol,overviewMapControl:a[f].overviewmapcontrol,streetViewControl:a[f].streetviewcontrol,draggable:a[f].draggable,mapTypeControl:a[f].maptypecontrol,mapTypeId:google.maps.MapTypeId[a[f].maptypeid]};
l=wp.hooks.applyFilters("eventorganiser.google_map_options",l);l=new google.maps.Map(document.getElementById("eo_venue_map-"+(f+1)),l);for(var e=new google.maps.LatLngBounds,m=[],c=0;c<j.length;c++){var k=j[c].lat,o=j[c].lng;if(k!==undefined&&o!=undefined){m.push(new google.maps.LatLng(k,o));e.extend(m[c]);k={venue_id:j[c].venue_id,position:m[c],map:l,content:j[c].tooltipContent,icon:j[c].icon};k=wp.hooks.applyFilters("eventorganiser.venue_marker_options",k);k=new google.maps.Marker(k);eventorganiser.map[f].markers[j[c].venue_id]=
k;"false"!=a[f].tooltip&&google.maps.event.addListener(k,"click",eventorganiser_venue_tooltip)}}j.length>1?l.fitBounds(e):l.setCenter(m[0])}}
function eventorganiser_venue_tooltip(){var a=this.getMap(),f=this.getMap().getProjection().fromLatLngToPoint(this.position),j=a.getProjection().fromLatLngToPoint(a.getBounds().getNorthEast()),l=a.getProjection().fromLatLngToPoint(a.getBounds().getSouthWest());a=Math.pow(2,a.getZoom());f=new google.maps.Point((f.x-l.x)*a,(f.y-j.y)*a);wp.hooks.doAction("eventorganiser.venue_marker_clicked",this);f=[f.x,f.y];if(this.tooltip){this.tooltip.qtip("api").set("position.target",f);this.tooltip.qtip("show")}else{jQuery(this.getMap().getDiv()).css({overflow:"visible"});
this.tooltip=jQuery("<div />").qtip({content:{text:this.content},border:{radius:4,width:3},style:{classes:"ui-tooltip-shadow",widget:true},position:{at:"right center",my:"top center",target:f,container:jQuery(this.getMap().getDiv())},show:{ready:true,event:false,solo:true},hide:{event:"mouseleave unfocus"}})}};
